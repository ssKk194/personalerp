<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exams | EduFlow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-gray-50 flex hidden" id="examBody">

    <aside class="w-64 bg-white h-screen border-r fixed p-6">
        <h2 class="text-xl font-bold text-indigo-600 mb-10">EduFlow</h2>
        <nav class="space-y-2">
            <a href="dashboard.html" class="block p-3 text-gray-600 hover:bg-gray-100 rounded-lg">Dashboard</a>
            <a href="documents.html" class="block p-3 text-gray-600 hover:bg-gray-100 rounded-lg">Documents</a>
            <a href="exams.html" class="block p-3 bg-indigo-50 text-indigo-700 font-bold rounded-lg">Exams</a>
            <a href="assignments.html" class="block p-3 text-gray-600 hover:bg-gray-100 rounded-lg">Assignments</a>
            <a href="attendance.html" class="block p-3 text-gray-600 hover:bg-gray-100 rounded-lg">Attendance</a>
        </nav>
    </aside>

    <main class="ml-64 p-10 w-full">
        <div class="flex justify-between items-center mb-8 relative">
            <h1 class="text-3xl font-bold">Exam Schedule</h1>

            <div class="flex items-center gap-4">
                <button onclick="addNewExam()"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-indigo-700 shadow-md">+ Add
                    Exam</button>

                <div class="relative group z-[60]">
                    <button class="flex items-center gap-3 hover:scale-105 transition focus:outline-none">
                        <div class="text-right hidden sm:block">
                            <p class="text-sm font-bold text-gray-700" id="headerUserName">Student</p>
                            <p class="text-xs text-green-500">Online</p>
                        </div>
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"
                            class="w-12 h-12 rounded-full border-2 border-indigo-500 shadow-lg bg-gray-100 object-cover">
                    </button>

                    <div
                        class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden hidden group-hover:block transition-all duration-200 origin-top-right">
                        <div class="px-4 py-3 border-b border-gray-100 bg-gray-50">
                            <p class="text-xs font-bold text-gray-400 uppercase">Account</p>
                            <p class="text-sm font-bold text-gray-800 truncate" id="dropdownUserName">Student</p>
                        </div>
                        <a href="settings.html"
                            class="block px-4 py-3 text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition flex items-center gap-2">
                            ‚öôÔ∏è Settings
                        </a>
                        <button onclick="localStorage.removeItem('userName'); window.location.href='index.html';"
                            class="w-full text-left px-4 py-3 text-red-500 hover:bg-red-50 transition font-bold flex items-center gap-2">
                            üö™ Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead class="bg-gray-50 text-gray-500 text-sm uppercase">
                    <tr>
                        <th class="p-4 border-b">Subject</th>
                        <th class="p-4 border-b">Date</th>
                        <th class="p-4 border-b">Countdown</th>
                        <th class="p-4 border-b">Marks Scored</th>
                        <th class="p-4 border-b">Action</th>
                    </tr>
                </thead>
                <tbody id="examTable">
                </tbody>
            </table>
            <p id="emptyMsg" class="text-center p-8 text-gray-400 italic hidden">No exams added yet.</p>
        </div>
    </main>

    <script>
        // 1. Security Check
        if (!localStorage.getItem('userName')) window.location.href = "index.html";
        else {
            document.getElementById('examBody').classList.remove('hidden');
            const uName = localStorage.getItem('userName');
            if (document.getElementById('headerUserName')) document.getElementById('headerUserName').innerText = uName;
            if (document.getElementById('dropdownUserName')) document.getElementById('dropdownUserName').innerText = uName;

            const uPhoto = localStorage.getItem('userPhoto');
            const img = document.getElementById('headerUserName').parentElement.parentElement.querySelector('img');
            if (img) img.src = uPhoto || `https://api.dicebear.com/7.x/avataaars/svg?seed=${uName}`;
        }

        // 2. Load Exams from Memory
        let exams = JSON.parse(localStorage.getItem('myExams')) || [];

        function renderExams() {
            const tbody = document.getElementById('examTable');
            tbody.innerHTML = '';

            if (exams.length === 0) document.getElementById('emptyMsg').classList.remove('hidden');
            else document.getElementById('emptyMsg').classList.add('hidden');

            exams.forEach((exam, index) => {
                // Calculate Countdown
                const today = new Date();
                const examDate = new Date(exam.date);
                const diffTime = examDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                let timeText = diffDays > 0 ? `${diffDays} Days Left` : (diffDays === 0 ? "Today!" : "Completed");
                let timeClass = diffDays > 0 ? "text-orange-600 bg-orange-50" : (diffDays === 0 ? "text-red-600 bg-red-50" : "text-green-600 bg-green-50");

                const row = `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-4 font-medium text-gray-800">${exam.subject}</td>
                        <td class="p-4 text-gray-600">${exam.date}</td>
                        <td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold ${timeClass}">${timeText}</span></td>
                        <td class="p-4">
                            <input type="number" value="${exam.marks}" onchange="updateMarks(${index}, this.value)" 
                                   class="w-16 border rounded p-1 text-center focus:border-indigo-500 outline-none" placeholder="-">
                        </td>
                        <td class="p-4">
                            <button onclick="deleteExam(${index})" class="text-red-400 hover:text-red-600 font-bold">√ó</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // 3. Add New Exam Logic
        window.addNewExam = function () {
            const subject = prompt("Enter Subject Name:");
            const date = prompt("Enter Exam Date (YYYY-MM-DD):");

            if (subject && date) {
                exams.push({ subject, date, marks: "" });
                saveAndRender();
            }
        };

        // 4. Update & Delete Logic
        window.updateMarks = function (index, value) {
            exams[index].marks = value;
            saveAndRender();
        };

        window.deleteExam = function (index) {
            if (confirm("Delete this exam?")) {
                exams.splice(index, 1);
                saveAndRender();
            }
        };

        function saveAndRender() {
            localStorage.setItem('myExams', JSON.stringify(exams));
            renderExams();
        }

        // Run on load
        renderExams();
    </script>
</body>

</html>